<!DOCTYPE HTML>
<html lang="en" style="background: #353839; overflow-y: scroll;">
<head>
    <meta charset="UTF-8">
    <title>list - criterion</title>
    <style>
    body {
        margin: 20px;
        color: hsl(60, 30%, 96%);
        font-family: Arial, Helvetica, sans-serif;
    }


    /*  URLS  */
    a:link,
    a:visited {color: hsl(190, 81%, 67%); text-decoration: none; outline: none;}
    a:hover {color: hsl(80, 76%, 53%);}
    a:active {color: hsl(40, 93%, 51%);}
    /*  URLS  */

    #table-container > table {
        border-collapse: collapse;
    }
    #table-container > table > thead > tr > th {
        border: 1px solid #000;
        padding: 8px;
    }
    #table-container > table > tbody > tr > td {
        border: 1px solid #000;
        padding: 8px;
    }

    td.type,
    td.spine_\# {
        text-align: center;
    }
    div.external_icons {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
    }
    div.external_icons img {
        margin: 4px;
        width: 32px;
    }
    </style>
</head>
<body>

<div id="table-container"></div>

<script>

async function fetchData() {

    try {
        const response = await fetch('data.json');
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const data = await response.json();
        return data;
    }

    catch (error) {
        console.error('There was a problem fetching the data:', error);
    }
}


function icons(key) {

    var icons = {
        "imdb": "imdb.svg",
        "wikipedia": "wikipedia.svg",
        "wikidata": "wikidata.svg",
        "icheckmovies": "",
        "letterboxd": ""
    }

    return icons[key];
}


function createTable(data) {
    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const tbody = document.createElement('tbody');

    const headers = ['Cover', 'Type', 'Format', 'URL', 'Spine #', 'Title', 'Director', 'Country', 'Year', 'Duration<br><span>minutes</span>', 'Color', 'Aspect Ratio', 'Language', 'External'];
    const headerRow = document.createElement('tr');

    headers.forEach(header => {
        const th = document.createElement('th');
        th.innerHTML = header;
        headerRow.appendChild(th);
    });

    thead.appendChild(headerRow);
    table.appendChild(thead);

    data.entries.forEach(entry => {
        const dataRow = document.createElement('tr');

        // Cover (leave empty for now)
        const coverCell = document.createElement('td');
        coverCell.textContent = ''; // Empty for now
        dataRow.appendChild(coverCell);

        const fields = ['type', 'format', 'url', 'spine_#', 'title', 'director', 'country', 'year', 'duration', 'color', 'aspect_ratio', 'language'];
        fields.forEach(field => {

            if (field == `country`) {
                entry[field] = entry[field].replace(/,$/, ``);
            }

            const td = document.createElement('td');
            td.textContent = entry[field];
            td.className = field;
            dataRow.appendChild(td);
        });

        // External links (icons)
        const externalCell = document.createElement('td');
        const externalCellDiv = document.createElement('div');
              externalCellDiv.className = `external_icons`;
              externalCell.appendChild(externalCellDiv);
        const externalLinks = entry.external;
        for ([key, value] of Object.entries(externalLinks)) {
            if (value) {
                const icon_a = document.createElement('a');
                      icon_a.href = value;
                      icon_a.target = `_blank`;

                const icon_img = document.createElement('img');
                      icon_img.src = `icons/${icons(key)}`; // Replace with actual icon paths
                      icon_img.alt = key;

                icon_a.appendChild(icon_img);
                externalCellDiv.appendChild(icon_a);
            }
        }
        dataRow.appendChild(externalCell);

        tbody.appendChild(dataRow);
    });

    table.appendChild(tbody);
    document.getElementById(`table-container`).appendChild(table);
}

fetchData().then(data => {
    if (data && data.entries) {
        createTable(data);
    } else {
        console.error('No entries found in the data.');
    }
});


</script>


</body>
</html>
