<!DOCTYPE HTML>
<html lang="en" style="background: #353839; overflow-y: scroll;">
<head>
    <meta charset="UTF-8">
    <title>list - criterion</title>
    <style>
    body {
        margin: 0;
        color: hsl(60, 30%, 96%);
        font-family: Arial, Helvetica, sans-serif;
        font-size: 0;
    }


    /*  URLS  */
    a:link,
    a:visited {color: hsl(190, 81%, 67%); text-decoration: none; outline: none;}
    a:hover {color: hsl(80, 76%, 53%);}
    a:active {color: hsl(40, 93%, 51%);}
    /*  URLS  */

    #table-container > table {
        margin: 0 auto;
        border-collapse: collapse;
        font-size: 16px;
    }
    #table-container > table > tbody > tr > td {
        padding: 6px;
        border-left: none;
        border-right: none;
    }
    #table-container > table > tbody > tr:not(:last-of-type) > td {
        border-bottom: 3px solid #000;
    }

    #table-container > table > tbody > tr > td.cover img {
        display: block;
        border: 3px solid #000;
        border-radius: 6px;
    }


    td.type,
    td.spine_\# {
        text-align: center;
    }
    td.external_icons {
/*        padding: 8px !important;*/
    }
    td.external_icons div {
        display: flex;
        flex-direction: column;
/*        flex-wrap: wrap;*/
        justify-content: center;
        align-items: center;
    }
    td.external_icons div img {
        margin: 1px;
        width: 32px;
    }
    </style>
</head>
<body>

<div id="table-container"></div>

<script>

async function fetchData() {

    try {
        const response = await fetch('data.json');
        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const data = await response.json();
        return data;
    }

    catch (error) {
        console.error('There was a problem fetching the data:', error);
    }
}


// cover
function cover(dataRow, entry) {

    const td = document.createElement('td');
          td.className = `cover`;

    const cover = document.createElement('img');
          cover.loading = `lazy`;
          cover.src     = `covers/${entry.cover.thumbnail.split('/')[4]}/thumbnail/${entry.cover.thumbnail.split('/')[6]}`;

    td.appendChild(cover)

    dataRow.appendChild(td);
}


// title
function title(dataRow, entry) {

    const a = document.createElement('a');
          a.href = entry.criterion_url;
          a.textContent = entry.title;
          a.style.fontWeight = `bold`;
          a.target = `_blank`;

    const td = document.createElement('td');
          td.className = `title`;
          td.appendChild(a);
          td.innerHTML += `
${entry.director ? `<br><br>Directed by ${entry.director}` : ``}
`;

    dataRow.appendChild(td);
}


// more_info
function more_info(dataRow, entry) {

    const td = document.createElement('td');
          td.innerHTML = `
${entry.type ? `${entry.type}<br>` : ``}
${entry.country ? `<br>${entry.country.replace(/,$/, ``)}` : ``}
${entry.year ? `<br>${entry.year}` : ``}
${entry.duration_minutes ? `<br>\n${entry.duration_minutes} minutes` : ``}
${entry.color ? `<br>\n${entry.color}` : ``}
${entry.aspect_ratio ? `<br>\n${entry.aspect_ratio}` : ``}
${entry.language ? `<br>\n${entry.language}` : ``}
${entry[`spine_#`] && entry[`spine_#`] != `0` ? `<br>\n<b>Spine #${entry[`spine_#`]}</b>` : ``}
`;
          td.className = `more_info`;

    dataRow.appendChild(td);
}


// format
function format(dataRow, entry) {

    const td = document.createElement('td');
          td.innerHTML = entry.format && entry.format != `0` ? entry.format.replace(`, `, `<br><br><br>`).replace(` SRP`, `<br>SRP`).replace(`DVD `, `DVD<br>`).replace(`BLU-RAY `, `BLU-RAY<br>`).replace(`DISC `, `DISC<br>`) : ``;
          td.className = `format`;
          td.style.whiteSpace = `pre`;
          td.style.textAlign = `center`;

    dataRow.appendChild(td);
}


// external
function external(dataRow, entry) {

    var icons = {
        "imdb": "imdb.svg",
        "wikipedia": "wikipedia.svg",
        "wikidata": "wikidata_white.svg",
        "icheckmovies": "icheckmovies_32x32.png",
        "letterboxd": "letterboxd-decal-dots-neg-rgb-optimized.svg"
    }

    // External links (icons)
    const externalCell = document.createElement('td');
          externalCell.className = `external_icons`;

    const externalCellDiv = document.createElement('div');
          externalCell.appendChild(externalCellDiv);

    for ([key, value] of Object.entries(entry.external)) {
        if (value) {
            const icon_a = document.createElement('a');
                  icon_a.href = value;
                  icon_a.target = `_blank`;

            const icon_img = document.createElement('img');
                  icon_img.src = `icons/${icons[key]}`; // Replace with actual icon paths
                  icon_img.alt = key;

            icon_a.appendChild(icon_img);
            externalCellDiv.appendChild(icon_a);
        }
    }

    dataRow.appendChild(externalCell);
}


function createTable(data) {
    const table = document.createElement('table');
    // const thead = document.createElement('thead');
    const tbody = document.createElement('tbody');

    // const headers = ['Type', 'Cover', '', '', 'Format', 'External'];
    // const headerRow = document.createElement('tr');

    // headers.forEach(header => {
    //     const th = document.createElement('th');
    //     th.innerHTML = header;
    //     headerRow.appendChild(th);
    // });

    // thead.appendChild(headerRow);
    // table.appendChild(thead);

    data.entries.forEach(entry => {

        const dataRow = document.createElement('tr');

        cover(dataRow, entry);
        title(dataRow, entry);
        more_info(dataRow, entry);
        format(dataRow, entry);
        external(dataRow, entry);

        tbody.appendChild(dataRow);
    });

    table.appendChild(tbody);
    document.getElementById(`table-container`).appendChild(table);
}

fetchData().then(data => {
    if (data && data.entries) {
        createTable(data);
    } else {
        console.error('No entries found in the data.');
    }
});


</script>


</body>
</html>
